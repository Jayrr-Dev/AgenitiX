/**
 * {{titleCase kind}} NODE - Clean content-focused node template
 *
 * â€¢ Focuses ONLY on content and layout - no structural styling
 * â€¢ withNodeScaffold handles all borders, sizing, theming, interactive states
 * â€¢ Schema-driven controls in Node Inspector
 * â€¢ Type-safe data validation with Zod schema
 * â€¢ Clean separation of concerns for maximum maintainability
 *
 * Keywords: {{kebabCase kind}}, content-focused, schema-driven, type-safe, clean-architecture
 */

import type { NodeProps } from '@xyflow/react';
import { useState } from 'react';
import { z } from 'zod';

import { withNodeScaffold } from '@/features/business-logic-modern/infrastructure/node-core/withNodeScaffold';
import type { NodeSpec } from '@/features/business-logic-modern/infrastructure/node-core/NodeSpec';
import {
  createNodeValidator,
  CommonSchemas,
  reportValidationError,
  useNodeDataValidation
} from '@/features/business-logic-modern/infrastructure/node-core/validation';
import { SafeSchemas, createSafeInitialData } from '@/features/business-logic-modern/infrastructure/node-core/schema-helpers';
import { CATEGORIES } from '@/features/business-logic-modern/infrastructure/theming/categories';
import { EXPANDED_SIZES, COLLAPSED_SIZES } from '@/features/business-logic-modern/infrastructure/theming/sizing';
import { ExpandCollapseButton } from '@/components/nodes/ExpandCollapseButton';

// -- PLOP-INJECTED-IMPORTS --

/**
 * Data schema for {{titleCase kind}} node
 * Define your node's data structure - controls are automatically generated
 */
const {{pascalCase kind}}DataSchema = z.object({
  // Basic fields - customize as needed
  text: SafeSchemas.text('Default text'),
  isEnabled: SafeSchemas.boolean(true),
  isActive: SafeSchemas.boolean(false),

  // Add your fields here - controls are auto-generated:
  // description: SafeSchemas.optionalText(),
  // count: SafeSchemas.number(1, 1, 100),
  // priority: SafeSchemas.enum(['low', 'medium', 'high'], 'medium'),

  // Optional user-editable title shown above the node
  label: SafeSchemas.optionalText(),
  description: SafeSchemas.optionalText(),
}).passthrough();

type {{pascalCase kind}}Data = z.infer<typeof {{pascalCase kind}}DataSchema>;

// Create enterprise validator
const validateNodeData = createNodeValidator({{pascalCase kind}}DataSchema, '{{pascalCase kind}}');

/**
 * Node specification with schema-driven controls
 */
const spec: NodeSpec = {
  kind: '{{camelCase kind}}',
  displayName: '{{camelCase kind}}',
  category: CATEGORIES.{{constantCase category}},
  size: {
    expanded: {{expandedSizeConstant expandedSize}},
    collapsed: {{collapsedSizeConstant collapsedSize}},
  },
  handles: [
    { id: 'json-input', code: 'j', position: 'top', type: 'target' },
    { id: 'output', code: 's', position: 'right', type: 'source' },
    { id: 'activate', code: 'b', position: 'left', type: 'target' },
  ],
  inspector: {
    key: '{{pascalCase kind}}Inspector',
  },
  version: 1,
  runtime: {
    execute: '{{camelCase kind}}_execute_v1',
  },
  initialData: createSafeInitialData({{pascalCase kind}}DataSchema),
  dataSchema: {{pascalCase kind}}DataSchema,
};

/**
 * Content-focused styling constants
 * Only handles internal layout and content - no structural styling
 */
const CONTENT_STYLES = {
  // Content area layouts
  content: {
    expanded: "p-4 w-full h-full flex flex-col",
    collapsed: "flex items-center justify-center w-full h-full",
  },

  // Header layouts
  header: {
    container: "flex items-center justify-between mb-3",
  },

  // Main content layouts
  main: {
    container: "flex-1 flex items-center justify-center",
    content: "text-center",
    icon: "text-2xl mb-2",
  },

  // Collapsed state layouts
  collapsed: {
    icon: "text-2xl",
  },
} as const;

/**
 * Category-specific text colors from design system
 */
const CATEGORY_TEXT_COLORS = {
  CREATE: {
    primary: "text-[var(--node-create-text)]",
    secondary: "text-[var(--node-create-text-secondary)]",
  },
  VIEW: {
    primary: "text-[var(--node-view-text)]",
    secondary: "text-[var(--node-view-text-secondary)]",
  },
  TRIGGER: {
    primary: "text-[var(--node-trigger-text)]",
    secondary: "text-[var(--node-trigger-text-secondary)]",
  },
  TEST: {
    primary: "text-[var(--node-test-text)]",
    secondary: "text-[var(--node-test-text-secondary)]",
  },
  CYCLE: {
    primary: "text-[var(--node-cycle-text)]",
    secondary: "text-[var(--node-cycle-text-secondary)]",
  },
} as const;

/**
 * {{camelCase kind}} Node Component
 *
 * Clean content-focused component:
 * â€¢ withNodeScaffold handles ALL structural styling
 * â€¢ Component focuses ONLY on content and layout
 * â€¢ Uses design system tokens for text colors
 * â€¢ Schema-driven controls available in Node Inspector
 * â€¢ Maintains enterprise validation and type safety
 */
const {{pascalCase kind}}NodeComponent = ({ data, id }: NodeProps) => {
  const [isExpanded, setExpanded] = useState(false);

  // Enterprise validation with comprehensive error handling
  const validationResult = validateNodeData(data);
  const nodeData = validationResult.data;

  // Report validation errors for monitoring
  if (!validationResult.success) {
    reportValidationError('{{pascalCase kind}}', id, validationResult.errors, {
      originalData: validationResult.originalData,
      component: '{{pascalCase kind}}NodeComponent',
    });
  }

  // Enterprise data validation hook for real-time updates
  const { getHealthScore } = useNodeDataValidation(
    {{pascalCase kind}}DataSchema,
    '{{pascalCase kind}}',
    nodeData,
    id
  );

  const onToggle = () => setExpanded((prev) => !prev);

  // Get category-specific text colors
  const categoryKey = spec.category as keyof typeof CATEGORY_TEXT_COLORS;
  const categoryTextColors = CATEGORY_TEXT_COLORS[categoryKey] || CATEGORY_TEXT_COLORS.CREATE;

  return (
    <>
      <ExpandCollapseButton showUI={isExpanded} onToggle={onToggle} size="sm" />

      {isExpanded ? (
        <div className={CONTENT_STYLES.content.expanded}>
          <div className={CONTENT_STYLES.header.container}>
            <h3 className={`text-sm font-semibold ${categoryTextColors.primary}`}>
              {{camelCase kind}}
            </h3>
            {process.env.NODE_ENV === 'development' && (
              <span className={`text-xs ${categoryTextColors.secondary}`}>
                Health: {getHealthScore()}%
              </span>
            )}
          </div>

          {/* Add your node-specific UI here */}
          <div className={CONTENT_STYLES.main.container}>
            <div className={CONTENT_STYLES.main.content}>
              <div className={CONTENT_STYLES.main.icon}>ðŸ”§</div>
              <div className={`text-xs ${categoryTextColors.secondary}`}>
                {nodeData.isEnabled ? nodeData.text : 'Disabled'}
              </div>
            </div>
          </div>
        </div>
      ) : (
        <div className={CONTENT_STYLES.content.collapsed}>
          <span className={CONTENT_STYLES.collapsed.icon} aria-label="{{titleCase kind}} Node">
            ðŸ”§
          </span>
        </div>
      )}
    </>
  );
};

export default withNodeScaffold(spec, {{pascalCase kind}}NodeComponent);

// Export spec for registry access
export { spec };
